!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Overlay={})}(this,(function(t){"use strict";class e{constructor(t){this.viewport=t}}class o extends e{overflowed(t){const e=this.viewport,o=window.innerWidth-(t.x+t.width),r=window.innerWidth-this.viewport.right;return{left:Math.max(e.left-t.x,0),right:Math.max(r-o,0),top:Math.max(e.top-t.y,0),bottom:Math.max(t.y+t.height-e.bottom,0)}}}class r{static merge(t,e){var o,r,i,n;return new DOMRect(null!==(o=e.x)&&void 0!==o?o:t.x,null!==(r=e.y)&&void 0!==r?r:t.y,null!==(i=e.width)&&void 0!==i?i:t.width,null!==(n=e.height)&&void 0!==n?n:t.height)}static reflowHorizontal(t,e){return t.style.left=`${e.left}px`,t.style.top=`${e.top}px`,t.style.width=`${e.width}px`,t.style.height=null,t.getBoundingClientRect()}}class i{constructor(t){this.parent=t}performLayout(t,e,o,r){const i=this.performLayoutHorizontal(t,e,o,r);return this.performLayoutVertical(t,i,o,r)}}class n extends i{performLayoutVertical(t,e,o){let i=o.overflowed(e);return i.bottom?e=r.merge(e,{y:e.y+i.top,height:Math.max(e.height-i.top,0)}):i.top&&(e=r.merge(e,{y:e.y+i.top})),e}performLayoutHorizontal(t,e,o,i){let n=o.overflowed(e),s=!1;return n.left&&(e=r.merge(e,{x:e.x+n.left,width:e.width-n.left}),e=r.reflowHorizontal(t,e),s=!0),n.right&&(e=r.merge(e,{width:e.width-n.right}),e=r.reflowHorizontal(t,e),s=!0),s&&(e=r.merge(e,{y:i(e).y})),e}}class s extends i{performLayoutVertical(t,e,o,i){var n,s;let l=o.overflowed(e),a=!1;return l.bottom?(e=r.merge(e,{y:e.y-l.bottom}),l=o.overflowed(e),l.top&&(a=!0)):l.top&&(e=r.merge(e,{y:e.y+l.top}),l=o.overflowed(e),l.bottom&&(a=!0)),a&&null!==(s=null===(n=this.parent)||void 0===n?void 0:n.performLayoutVertical(t,e,o,i))&&void 0!==s?s:e}performLayoutHorizontal(t,e,o,i){var n,s;let l=o.overflowed(e),a=!1;return l.left?(e=r.merge(e,{x:e.x+l.left}),l=o.overflowed(e),l.right&&(a=!0)):l.right&&(e=r.merge(e,{x:e.x-Math.max(l.right,o.viewport.left)}),l=o.overflowed(e),l.left&&(a=!0)),a&&null!==(s=null===(n=this.parent)||void 0===n?void 0:n.performLayoutHorizontal(t,e,o,i))&&void 0!==s?s:e}}class l{}class a extends l{createOverlayConstraint(t){return new o(t)}performLayout(t){var e;const o=t.getBoundingClientRect(),n=t.targetRect,s=t.viewportRect,l=t.behavior,a=null!==(e=null==l?void 0:l.alignment)&&void 0!==e?e:u.ALL,h=r.merge(o,this.perfromLayoutPosition(o,n)),d=this.createOverlayConstraint(s),c=t=>this.perfromLayoutPosition(t,n);let p=h;if(a instanceof i)p=a.performLayout(t,h,d,c);else{console.assert(null!=a.horizontal),console.assert(null!=a.vertical);const e=a.horizontal.performLayoutHorizontal(t,h,d,c);p=a.vertical.performLayoutVertical(t,e,d,c)}return{initialRect:h,correctedRect:p}}}class h extends a{perfromLayoutPosition(t,e){return{x:this.getPositionHorizontal(t,e),y:e.y+(e.height-t.height)/2}}}class d extends a{perfromLayoutPosition(t,e){return{x:e.x+(e.width-t.width)/2,y:this.getPositionVertical(t,e)}}}const c={BOTTOM_CENTER:new class extends d{getPositionVertical(t,e){return e.bottom}},BOTTOM_RIGHT:new class extends a{perfromLayoutPosition(t,e){return{x:e.left,y:e.bottom}}},BOTTOM_LEFT:new class extends a{perfromLayoutPosition(t,e){return{x:e.right-t.width,y:e.bottom}}},TOP_CENTER:new class extends d{getPositionVertical(t,e){return e.top-t.height}},TOP_RIGHT:new class extends a{perfromLayoutPosition(t,e){return{x:e.left,y:e.top-t.height}}},TOP_LEFT:new class extends a{perfromLayoutPosition(t,e){return{x:e.right-t.width,y:e.y-t.height}}},LEFT:new class extends h{getPositionHorizontal(t,e){return e.left-t.width}},RIGHT:new class extends h{getPositionHorizontal(t,e){return e.right}}},u={ALL:new s(new n),NONE:new class extends i{performLayoutVertical(t,e){return e}performLayoutHorizontal(t,e){return e}},SIZE:new n,POSITION:new s};class p{static attach({element:t,target:e,parent:o,behavior:r}){if(null==t)throw new Error("todo");if(null==e)throw new Error("todo");if(null==o)throw new Error("todo");const i=document.createElement("overlay-wrapper");return i.append(t),i.target=e,i.parent=o,i.behavior=null!=r?r:p.defaultBehavior,this.overlays.set(t,i),o.append(i),i}static detach(t){console.log(this.overlays.get(t))}static at({element:t,parent:e,behavior:o,position:r}){const i=document.createElement("overlay-wrapper");return i.append(t),i.target=new DOMRect(r.x,r.y),i.parent=null!=e?e:document.body,i.behavior=null!=o?o:p.defaultBehavior,this.overlays.set(t,i),e.append(i),i}}p.overlays=new Map,p.defaultBehavior={layout:c.BOTTOM_CENTER};class y extends HTMLElement{get raw(){return this.firstElementChild}get targetRect(){return this.target instanceof HTMLElement?this.target.getBoundingClientRect():this.target}get viewportRect(){return this.parent.getBoundingClientRect()}markNeedRepaint(){this.unsetLayout(),this.performLayout()}unsetLayout(){this.style.width="max-content",this.style.height="max-content",this.style.left="0px",this.style.top="0px",this.getBoundingClientRect()}disconnectedCallback(){this.observer.disconnect(),window.removeEventListener("resize",this.markNeedRepaint.bind(this)),window.removeEventListener("scroll",this.markNeedRepaint.bind(this))}connectedCallback(){this.style.display="block",this.style.position="fixed",this.style.left="0px",this.style.top="0px",this.style.width="max-content",this.style.height="max-content",this.performLayout(),this.observer=new MutationObserver(this.markNeedRepaint.bind(this)),this.observer.observe(this.firstElementChild,{attributes:!0,characterData:!0,subtree:!0,childList:!0}),window.addEventListener("resize",this.markNeedRepaint.bind(this)),window.addEventListener("scroll",this.markNeedRepaint.bind(this))}performLayout(){var t;const e=this.behavior.layout.performLayout(this),o=e.correctedRect;this.style.width=`${o.width}px`,this.style.height=`${o.height}px`,this.style.left=`${o.x}px`,this.style.top=`${o.y}px`,null===(t=this.reflowBehindBuilder)||void 0===t||t.call(this.raw,e)}}customElements.define("overlay-wrapper",y),t.DrivenOverlayLayout=a,t.Overlay=p,t.OverlayAlignment=u,t.OverlayDirection=c,t.OverlayElement=y,t.OverlayLayout=l}));
//# sourceMappingURL=index.umd.js.map
