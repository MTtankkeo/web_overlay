!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Overlay={})}(this,(function(t){"use strict";class e{constructor(t,e){this.viewport=t,this.alignment=e}}class r extends e{getOverflowed(t){const e=this.viewport,r=window.innerWidth-(t.x+t.width),i=window.innerWidth-this.viewport.right;return{left:Math.max(e.left-t.x,0),right:Math.max(i-r,0),top:Math.max(e.top-t.y,0),bottom:Math.max(t.y+t.height-e.bottom,0)}}}class i{static merge(t,e){var r,i,o,n;return new DOMRect(null!==(r=e.x)&&void 0!==r?r:t.x,null!==(i=e.y)&&void 0!==i?i:t.y,null!==(o=e.width)&&void 0!==o?o:t.width,null!==(n=e.height)&&void 0!==n?n:t.height)}static reflowHorizontal(t,e){return t.style.left=`${e.left}px`,t.style.top=`${e.top}px`,t.style.width=`${e.width}px`,t.style.height=null,t.getBoundingClientRect()}}class o{constructor(t,e){this.element=t,this.reposition=e}performLayout(t,e){return this.performLayoutVertical(this.performLayoutHorizontal(t,e),e)}}class n extends o{constructor(t,e,r){super(e,r),this.behavior=t}performLayoutHorizontal(t,e){let r=e.getOverflowed(t),o=!1;if(r.left?(t=i.merge(t,{x:t.x+r.left}),r=e.getOverflowed(t),r.right&&(t=i.merge(t,{width:t.width-r.right}),t=i.reflowHorizontal(this.element,t),o=!0)):r.right&&(t=i.merge(t,{x:t.x-Math.max(r.right,e.viewport.left)}),r=e.getOverflowed(t),r.left&&(t=i.merge(t,{x:t.x+r.left,width:t.width-r.left}),t=i.reflowHorizontal(this.element,t),o=!0)),o){const e=this.reposition(t);t=i.merge(t,{y:e.y})}return t}performLayoutVertical(t,e){let r=e.getOverflowed(t);if(r.bottom){if(t=i.merge(t,{y:t.y-r.bottom}),r=e.getOverflowed(t),r.top)return i.merge(t,{y:t.y+r.top,height:Math.max(t.height-r.top,0)})}else if(r.top&&(t=i.merge(t,{y:t.y+r.top}),r=e.getOverflowed(t),r.bottom))return i.merge(t,{height:Math.max(t.height-r.bottom,0)});return t}}class s{}class a extends s{createOverlayConstraint(t,e){return new r(t,e)}createOverlayLayoutCorrector(t,e,r){return new n(e,t,r)}performLayout(e){const r=e.getBoundingClientRect(),o=e.targetRect,n=e.viewportRect,s=e.behavior,a=i.merge(r,this.perfromLayoutPosition(r,o)),l=this.createOverlayConstraint(n,t.OverlayAlignment.ALL);return{initialRect:a,correctedRect:this.createOverlayLayoutCorrector(e,s,(t=>this.perfromLayoutPosition(t,o))).performLayout(a,l)}}}class l extends a{perfromLayoutPosition(t,e){return{x:this.getPositionHorizontal(t,e),y:e.y+(e.height-t.height)/2}}}class h extends a{perfromLayoutPosition(t,e){return{x:e.x+(e.width-t.width)/2,y:this.getPositionVertical(t,e)}}}const d={BOTTOM_CENTER:new class extends h{getPositionVertical(t,e){return e.bottom}},BOTTOM_RIGHT:new class extends a{perfromLayoutPosition(t,e){return{x:e.left,y:e.bottom}}},BOTTOM_LEFT:new class extends a{perfromLayoutPosition(t,e){return{x:e.right-t.width,y:e.bottom}}},TOP_CENTER:new class extends h{getPositionVertical(t,e){return e.top-t.height}},TOP_RIGHT:new class extends a{perfromLayoutPosition(t,e){return{x:e.left,y:e.top-t.height}}},TOP_LEFT:new class extends a{perfromLayoutPosition(t,e){return{x:e.right-t.width,y:e.y-t.height}}},LEFT:new class extends l{getPositionHorizontal(t,e){return e.left-t.width}},RIGHT:new class extends l{getPositionHorizontal(t,e){return e.right}}};var c;t.OverlayAlignment=void 0,(c=t.OverlayAlignment||(t.OverlayAlignment={})).ALL="all",c.NONE="none",c.SIZE="size",c.POSITION="position";class u{static attach({element:t,target:e,parent:r,behavior:i}){if(null==t)throw new Error("todo");if(null==e)throw new Error("todo");if(null==r)throw new Error("todo");const o=document.createElement("overlay-wrapper");return o.append(t),o.target=e,o.parent=r,o.behavior=null!=i?i:u.defaultBehavior,this.overlays.set(t,o),r.append(o),o}static detach(t){console.log(this.overlays.get(t))}static at({element:t,parent:e,behavior:r,position:i}){const o=document.createElement("overlay-wrapper");return o.append(t),o.target=new DOMRect(i.x,i.y),o.parent=null!=e?e:document.body,o.behavior=null!=r?r:u.defaultBehavior,this.overlays.set(t,o),e.append(o),o}}u.overlays=new Map,u.defaultBehavior={layout:d.BOTTOM_CENTER};class y extends HTMLElement{get raw(){return this.firstElementChild}get targetRect(){return this.target instanceof HTMLElement?this.target.getBoundingClientRect():this.target}get viewportRect(){return this.parent.getBoundingClientRect()}markNeedRepaint(){this.unsetLayout(),this.performLayout()}unsetLayout(){this.style.width="max-content",this.style.height="max-content",this.style.left="0px",this.style.top="0px",this.getBoundingClientRect()}disconnectedCallback(){this.observer.disconnect(),window.removeEventListener("resize",this.markNeedRepaint.bind(this)),window.removeEventListener("scroll",this.markNeedRepaint.bind(this))}connectedCallback(){this.style.display="block",this.style.position="fixed",this.style.left="0px",this.style.top="0px",this.style.width="max-content",this.style.height="max-content",this.performLayout(),this.observer=new MutationObserver(this.markNeedRepaint.bind(this)),this.observer.observe(this.firstElementChild,{attributes:!0,characterData:!0,subtree:!0,childList:!0}),window.addEventListener("resize",this.markNeedRepaint.bind(this)),window.addEventListener("scroll",this.markNeedRepaint.bind(this))}performLayout(){var t;const e=this.behavior.layout.performLayout(this),r=e.correctedRect;this.style.width=`${r.width}px`,this.style.height=`${r.height}px`,this.style.left=`${r.x}px`,this.style.top=`${r.y}px`,null===(t=this.reflowBehindBuilder)||void 0===t||t.call(this.raw,e)}}customElements.define("overlay-wrapper",y),t.DrivenOverlayLayout=a,t.Overlay=u,t.OverlayDirection=d,t.OverlayElement=y,t.OverlayLayout=s}));
//# sourceMappingURL=index.umd.js.map
